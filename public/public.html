<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Rusunawa</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-950 text-gray-100">

<div class="max-w-7xl mx-auto p-6">

<h1 class="text-3xl font-bold mb-6">üè¢ Dashboard Rusunawa</h1>

<!-- CARDS -->
<div id="cards" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-10"></div>

<!-- GRAFIK -->
<div class="bg-gray-900 p-5 rounded-xl border border-gray-800 mb-10">
<h3 class="font-bold mb-3">Jumlah Unit Terisi per Lantai</h3>
<canvas id="chart"></canvas>
</div>

<!-- STRUKTUR -->
<div id="struktur" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>

</div>

<script>
async function load(){
  const r = await fetch('/api/data?action=public');
  const j = await r.json();
  const d = j.data;

  cards.innerHTML = `
    ${card("Total Unit", d.totalUnit, "from-slate-700 to-slate-800")}
    ${card("Siap Huni", d.unitSiapHuni, "from-green-600 to-green-700")}
    ${card("Terisi", d.unitTerisi, "from-blue-600 to-blue-700")}
    ${card("Rusak", d.unitRusak, "from-red-600 to-red-700")}
  `;

  renderStruktur(d.struktur);
  drawChart(d.struktur);
}

function card(t,v,grad){
  return `<div class="bg-gradient-to-br ${grad} p-6 rounded-2xl shadow-lg">
    <div class="text-sm opacity-80 mb-1">${t}</div>
    <div class="text-4xl font-bold">${v}</div>
  </div>`;
}

function renderStruktur(data){
  let html = "";
  Object.keys(data).forEach(rusun=>{
    html += `<div class="bg-gray-900 p-4 rounded-xl border border-gray-800">
      <h3 class="font-bold mb-3">${rusun}</h3>`;
    Object.keys(data[rusun]).forEach(l=>{
      html += `<div class="flex justify-between text-sm border-b border-gray-800 py-1">
        <span>Lantai ${l}</span>
        <span>${data[rusun][l]} unit terisi</span>
      </div>`;
    });
    html += `</div>`;
  });
  struktur.innerHTML = html;
}

function drawChart(data){
  let labels=[], values=[];
  Object.keys(data).forEach(r=>{
    Object.keys(data[r]).forEach(l=>{
      labels.push(r+" Lantai "+l);
      values.push(data[r][l]);
    });
  });

  new Chart(chart,{
    type:'bar',
    data:{labels, datasets:[{data:values}]}
  });
}

load();
</script>

</body>
</html>
