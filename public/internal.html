<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Dashboard Internal Rusun</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-950 text-white">

<div class="flex">

<!-- SIDEBAR -->
<div class="w-64 bg-slate-900 min-h-screen p-5">
  <h1 class="text-xl font-bold mb-6">üè† RUSUN DASHBOARD</h1>
  <div class="text-slate-300 mb-2">Manajemen Penghuni</div>
  <a href="/login.html" class="text-red-400 mt-10 inline-block">Logout</a>
</div>

<!-- MAIN -->
<div class="flex-1 p-8">
  <h2 class="text-2xl font-bold mb-6">Dashboard Internal</h2>

  <!-- CARD -->
  <div class="grid grid-cols-4 gap-4 mb-8">
    <div class="bg-slate-800 p-4 rounded">Penghuni<br><b id="penghuni">-</b></div>
    <div class="bg-slate-800 p-4 rounded">Unit Terisi<br><b id="unitTerisi">-</b></div>
    <div class="bg-slate-800 p-4 rounded">Total Bayar<br><b id="totalBayar">Rp 0</b></div>
    <div class="bg-slate-800 p-4 rounded">Total Tunggakan<br><b id="totalTunggakan">Rp 0</b></div>
  </div>

  <!-- TABLE -->
  <div class="bg-slate-900 rounded p-5">
    <h3 class="font-bold mb-4">Daftar Penghuni</h3>
    <input id="search" placeholder="Cari unit / nama..." class="w-full p-2 mb-4 bg-slate-800 rounded">

    <table class="w-full text-sm">
      <thead class="border-b border-slate-700">
        <tr>
          <th class="py-2 text-left">Unit</th>
          <th class="py-2 text-left">Nama</th>
          <th class="py-2 text-left">Status</th>
          <th class="py-2 text-left">Total Bayar</th>
          <th class="py-2 text-left">Total Tunggakan</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>
</div>

<script>
const penghuni = document.getElementById("penghuni");
const unitTerisi = document.getElementById("unitTerisi");
const totalBayar = document.getElementById("totalBayar");
const totalTunggakan = document.getElementById("totalTunggakan");
const tbody = document.getElementById("tbody");
const search = document.getElementById("search");

async function loadData(){
  const res = await fetch("/api/data?action=internal&key=rusun2026");
  const json = await res.json();

  const sum = json.data.summary;
  const data = json.data.data;

  penghuni.innerText = sum.penghuni;
  unitTerisi.innerText = sum.terisi;
  totalBayar.innerText = "Rp " + sum.totalBayar.toLocaleString("id-ID");
  totalTunggakan.innerText = "Rp " + sum.totalTunggakan.toLocaleString("id-ID");

  render(data);
}

function render(data){
  tbody.innerHTML = "";
  data.forEach(d=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="py-1">${d.unit}</td>
      <td>${d.nama}</td>
      <td>${d.kondisiunit}</td>
      <td>Rp ${Number(d.pembayaran).toLocaleString("id-ID")}</td>
      <td>Rp ${Number(d.tunggakan).toLocaleString("id-ID")}</td>
    `;
    tbody.appendChild(tr);
  });
}

search.addEventListener("input",()=>{
  const v = search.value.toLowerCase();
  document.querySelectorAll("#tbody tr").forEach(tr=>{
    tr.style.display = tr.innerText.toLowerCase().includes(v) ? "" : "none";
  });
});

loadData();
</script>
</body>
</html>
